<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Mr. Anderson]]></title>
  <link href="http://kmc653.github.io/atom.xml" rel="self"/>
  <link href="http://kmc653.github.io/"/>
  <updated>2015-02-01T16:30:46+08:00</updated>
  <id>http://kmc653.github.io/</id>
  <author>
    <name><![CDATA[Kai-Min Change]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Use Sidekiq to Send Emails from Background Jobs]]></title>
    <link href="http://kmc653.github.io/blog/2015/01/31/use-sidekiq-to-send-emails-from-background-jobs/"/>
    <updated>2015-01-31T15:41:25+08:00</updated>
    <id>http://kmc653.github.io/blog/2015/01/31/use-sidekiq-to-send-emails-from-background-jobs</id>
    <content type="html"><![CDATA[<p>In Rails application, we usually send emails to notify users of something. Sending emails would not be fast because it need to rely on third party service ( e.q., Google, Yahoo, Mailgun ). We can put sending action in background process to make sure that application won&rsquo;t be held up.</p>

<h1>Sidekiq</h1>

<p>We can use sidekiq to make the jobs running in the background. It will avoid our app getting stuck if one of the processes broke.</p>

<p>At first, add gem <code>sidekiq</code> in <code>Gemfile</code>, and then run <code>bundle install</code> from command line</p>

<figure class='code'><figcaption><span>Gemfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s1">&#39;sidekiq&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>For instance, if we want to send an invitation email to user, the code should be</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">AppMailer</span><span class="o">.</span><span class="n">send_invitation_email</span><span class="p">(</span><span class="vi">@invitation</span><span class="p">)</span><span class="o">.</span><span class="n">deliver</span>
</span></code></pre></td></tr></table></div></figure>


<p>Using <code>sidekiq</code>, we add <code>delay</code> to make sending action processing in background.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">AppMailer</span><span class="o">.</span><span class="n">delay</span><span class="o">.</span><span class="n">send_invitation_email</span><span class="p">(</span><span class="vi">@invitation</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>We have to install <code>redis</code> server if we would like to set up background job processing locally. we can get Redis from here: <a href="http://redis.io/download">http://redis.io/download</a> .</p>

<p>Typing <code>redis-server</code> to run redis, and then type <code>bundle exec sidekiq</code> to execute sidekiq, and then run Rails applicaion server to send emails.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Use Concerns to DRY up Model]]></title>
    <link href="http://kmc653.github.io/blog/2015/01/29/use-concerns-to-dry-up-model/"/>
    <updated>2015-01-29T19:20:35+08:00</updated>
    <id>http://kmc653.github.io/blog/2015/01/29/use-concerns-to-dry-up-model</id>
    <content type="html"><![CDATA[<p>Different models in Rails application would have the code that have the same logic or functionality. Using <code>concerns</code> to put these same code in a module, which allow you to use in any models without repeating code.</p>

<h1>Set the path of module</h1>

<p>At first, we should add a line of code in <code>config/application.rb</code> to tell our app where to load the module file.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">autoload_paths</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="si">}</span><span class="s2">/lib&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Put the same functional code in module</h1>

<p>For instance, there is a invitation model which would generate token before creating a invitation.</p>

<figure class='code'><figcaption><span>invitation.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Invitation</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">before_create</span> <span class="ss">:generate_token</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:inviter</span><span class="p">,</span> <span class="ss">class_name</span><span class="p">:</span> <span class="s2">&quot;User&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">validates_presence_of</span> <span class="ss">:recipient_name</span><span class="p">,</span> <span class="ss">:recipient_email</span><span class="p">,</span> <span class="ss">:message</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">generate_token</span>
</span><span class='line'>      <span class="nb">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">urlsafe_base64</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;re able to put <code>before_create</code> and <code>generate_token</code> method in a module named <code>Tokenable</code>.</p>

<figure class='code'><figcaption><span>tokenable.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">Tokenable</span>
</span><span class='line'>  <span class="kp">extend</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Concern</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">included</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">before_create</span> <span class="ss">:generate_token</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">generate_token</span>
</span><span class='line'>      <span class="nb">self</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="no">SecureRandom</span><span class="o">.</span><span class="n">urlsafe_base64</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Afterward, we add <code>include</code> following the name of module in invitation model.</p>

<figure class='code'><figcaption><span>invitation.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Invitation</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">Tokenable</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:inviter</span><span class="p">,</span> <span class="ss">class_name</span><span class="p">:</span> <span class="s2">&quot;User&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">validates_presence_of</span> <span class="ss">:recipient_name</span><span class="p">,</span> <span class="ss">:recipient_email</span><span class="p">,</span> <span class="ss">:message</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Therefore, there is no need to have redundant code to acquire the same functionality.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[The Usage of strip, slice and split Methods of String]]></title>
    <link href="http://kmc653.github.io/blog/2014/12/27/the-usage-of-method-number-strip-and-slice-of-string/"/>
    <updated>2014-12-27T19:49:30+08:00</updated>
    <id>http://kmc653.github.io/blog/2014/12/27/the-usage-of-method-number-strip-and-slice-of-string</id>
    <content type="html"><![CDATA[<h1>Strip</h1>

<p>The method <code>strip</code> is used in a string. Returning the same content of string with leading and trailing whitespace removed.</p>

<pre><code>"   Kevin   ".strip     #=&gt; "Kevin"
</code></pre>

<p>The string will be changed if we use <code>strip!</code>. Return <code>nil</code> means the string was not altered.</p>

<pre><code>"Kevin".strip!     #=&gt; nil
</code></pre>

<h1>Slice</h1>

<p>The method <code>slice</code> is used in a string.<br/>
* <em>slice( index ) => str or nil</em><br/>
* <em>slice( start, length ) => str or nil</em><br/>
* <em>slice( range ) => str or nil</em><br/>
* <em>slice( regexp ) => str or nil</em><br/>
* <em>slice( regexp, capture ) => str or nil</em><br/>
* <em>slice( match_str ) => str or nil</em></p>

<pre><code>"kevin".slice(3)     #=&gt; "i"  
"kevin".slice(3, 2)     #=&gt; "in"  
"kevin".slice(1..3)     #=&gt; "evi"  
"kevinaeiou".slice(/[aeiou][0...9]/)
"kevin".slice("v")     #=&gt; "v"
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[The Usage of Module#delegate]]></title>
    <link href="http://kmc653.github.io/blog/2014/12/25/the-usage-of-module-number-delegate/"/>
    <updated>2014-12-25T11:06:29+08:00</updated>
    <id>http://kmc653.github.io/blog/2014/12/25/the-usage-of-module-number-delegate</id>
    <content type="html"><![CDATA[<h1>Delegate</h1>

<p><code>delegate</code> is particularly useful with Active Record associations:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class Movie &lt; ActiveRecord::Base
</span><span class='line'>  belongs_to :director
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>class Director &lt; ActiveRecord::Base
</span><span class='line'>  # has a string attribute 'name'
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>If we want to get the director&rsquo;s name of the movie, we should use <code>@movie.director.name</code>. However, if we use <code>delegate</code> in the code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class Movie &lt; ActiveRecord::Base
</span><span class='line'>  belongs_to :director
</span><span class='line'>  delegate :name, to: :director
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>We can only use <code>@movie.name</code> to get the name of director. Moreover, if we add options <code>prefix: true</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class Movie &lt; ActiveRecord::Base
</span><span class='line'>  belongs_to :director
</span><span class='line'>  delegate :name, to: :director, prefix: true
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>Only use <code>@movie.director_name</code> to get the director&rsquo;s name. It&rsquo;s more readable than before. We can also specify a custom prefix <code>:filmmaker</code>instead of <code>true</code>, then use <code>@movie.filmmaker_name</code> to get the same result.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[The Usage of Collect &amp; Map Methods]]></title>
    <link href="http://kmc653.github.io/blog/2014/12/21/the-usage-of-collect-and-map-methods/"/>
    <updated>2014-12-21T22:57:15+08:00</updated>
    <id>http://kmc653.github.io/blog/2014/12/21/the-usage-of-collect-and-map-methods</id>
    <content type="html"><![CDATA[<h1>Collect</h1>

<ul>
<li><em>collect { | item | block } => array</em></li>
<li><em>collect => Enumerator</em></li>
</ul>


<p>The method <code>collect</code> is used in an array. Returns a new array with the results of executing block once for each element in array.<br/>
If no block is given, an enummerator is returned instead.</p>

<pre><code>['a', 'b', 'c'].collect{ |letter| letter.capitalize }     #=&gt; ["A", "B", "C"]
</code></pre>

<p>There is a concise way doing the same work:</p>

<pre><code>['a', 'b', 'c'].collect(&amp;:capitalize)     #=&gt; ["A", "B", "C"]
</code></pre>

<p>The element will be replaced with the value returned by block if adding a <code>!</code></p>

<pre><code>a = ['a', 'b', 'c'].collect!(&amp;:capitalize)
a     #=&gt; ["A", "B", "C"]
</code></pre>

<h1>Map</h1>

<ul>
<li><em>map { | item | block } => array</em></li>
<li><em>map => Enumerator</em></li>
</ul>


<p>The method <code>map</code> is also used in an array.</p>

<pre><code>a = ['a', 'b', 'c']
a.map { |x| x + x }     #=&gt; ["aa", "bb", "cc"]
</code></pre>

<p>There is also a shorthand way:</p>

<pre><code>['a', 'b', 'c'].map(&amp;:capitalize)     #=&gt; ["A", "B", "C"]
</code></pre>

<p>The element will be replaced with the value returned by block if adding a <code>!</code></p>

<pre><code>a = ['A', 'B', 'C']
a.map!(&amp;:downcase)
a     #=&gt; ["a", "b", "c"]
</code></pre>
]]></content>
  </entry>
  
</feed>
